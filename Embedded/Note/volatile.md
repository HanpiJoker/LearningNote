# Volatile 的理解
## 定义
volatile是一个类型修饰符（type specifier），就像大家更熟悉的const一样，它是被设计用来修饰被不同线程访问和修改的变量。volatile的作用是作为指令关键字，确保本条指令不会因编译器的优化而省略，且要求每次直接读值。

## 作用
防止编译器对代码进行优化。
```c
i[2] = 0x55;
i[2] = 0x56;
i[2] = 0x57;
i[2] = 0x58;
```
对于上面四行代码, 对于外部硬件是四个不同的动作; 但是对于编译器来说, 它会把四条语句优化成一条。如果键入了volatile就会禁止这种优化;
这就意味着, 优化器用到volatile修饰的变量时必须小心的重新读取变量值, 而不是使用保存在寄存器里的备份。

## 理解
### 必须使用volatile的情况:
1. 在使用setjmp()和longjmp()时, 必须使用volatile。因为其他类型的变量, 都会在编译器优化之后存储在寄存器中备份; volatile修饰的变量一直在存储器中。
2. 并行设备的硬件寄存器(如: 状态寄存器);
3. 多线程应用中被几个任务共享的变量;
4. 一个中断服务子程序中会访问到的非自动变量;

### 几个问题
#### 1. 一个参数既可以是const还可以是volatile吗？
可以的，例如只读的状态寄存器。它是volatile因为它可能被意想不到地改变。它是const因为程序不应该试图去修改它。

#### 2. 一个指针可以是volatile 吗？
可以，当一个中服务子程序修该一个指向一个buffer的指针时。

### volatile的本质：
1. 编译器的优化:  
在本次线程内, 当读取一个变量时，为提高存取速度，编译器优化时有时会先把变量读取到一个寄存器中；以后，再取变量值时，就直接从寄存器中取值；当变量值在本线程里改变时，会同时把变量的新值copy到该寄存器中，以便保持一致。
当变量在因别的线程等而改变了值，该寄存器的值不会相应改变，从而造成应用程序读取的值和实际的变量值不一致。
当该寄存器在因别的线程等而改变了值，原变量的值不会改变，从而造成应用程序读取的值和实际的变量值不一致。
2. volatile应该解释为“直接存取原始内存地址”比较合适，“易变的”这种解释简直有点误导人。

# 几种类型修饰符区别和对比
关键字: auto, register, static, const, extern, volatile;
1. auto: 默认实现的, 分配的内存区域是可读可写; 若auto在块区域内, 则数据存放在栈中;
2. register: 限制变量定义在CPU的寄存器上, 提高访问速度。
**对于register修饰的变量来说, &(取地址)是不合法的**
3. static: 
> 1. 静态局部变量:(定义在函数内部的静态变量)
>> + 具有局部变量的作用域, 离开作用域后, 无法使用改变量。但是其存储空间依旧存在;
>> + 程序开始时分配了静态存储区, 生存期时整个程序运行期间;
>> + 其赋值发生在编译阶段, **仅初始化一次**。

> 2. 静态全局变量和函数
>> + 为了限制全局变量/函数的作用域, 函数或变量前加static。但此处“static”的含义不是指存储方式，而是指对函数的作用域仅局限于本文件(所以又称内部函数)。注意此时, 对于外部(全局)变量, 不论是否有static限制, 它的存储区域都是在静态存储区, 生存期都是全局的. 此时的static只是起作用域限制作用, 限定作用域在本模块(文件)内部。
>> + 使用内部函数的好处是：不同的人编写不同的函数时，不用担心自己定义的函数，是否会与其它文件中的函数同名。

4. const
在定义变量时使用(由于const常量在定义后不能被修改，所以在定义时一定要进行初始化操作)
- 最简单的用法，说明变量为一个常变量（在以下例子里，int 和const的先后顺序可以改变的，这无所谓）：
```c
     const int a=100; 
     int const b=100;
```
- 说明指针为指向常数的指针，即指针本身的值是可以改变的：
```c
    const int *a=&b；
```
- 说明指针本身的值不可改变，但指向的内容可改变：
```c
        * const a = &b；
```
- 指针为指向常数的常指针,即指针本身与指针指向的内容都不可改变：
```c
    const int * const a = &b；
```
- 说明引用为常数引用,即不能改变引用的值：
```c
     const int &a=100。
```     
- 作为参数使用，说明函数体内是不能修改该参数的：
```c
    void func(const int a)；
```
- 作为返回值使用，说明函数的返回值是不能被修改的：
```c
    const int func()；
```
- 函数中使用const,情况与定义变量的情况基本一致： 

**const默认具有外部链接, C会为每个const分配存储空间; 这也是const和#definei的区别**